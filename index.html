<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Fest Result 2025</title>

<link rel="icon" type="image/jpg" href="icon-bar.jpg">

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      fontFamily: { sans: ['Inter', 'sans-serif'] },
      colors: { 'fest-gold':'#ffd000','fest-silver':'#C0C0C0','fest-bronze':'#e7a36b','fest-gray':'#424242' }
    }
  }
}
</script>

<link rel="stylesheet" href="style.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="pb-12">

<!-- Header -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
  <header class="pt-8 pb-6 text-center">
    <h1 class="text-4xl md:text-5xl font-extrabold header-gradient">üèÜ Fest Result Portal</h1>
    <p class="mt-3 text-base text-white text-slate-600">Click a team card to open results. Modal shows the Top Scorer above detailed scores.</p>
  </header>

  <!-- Teams Podium -->
  <main>
    <section id="podium" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
      <!-- Team 1 -->
      <div class="place p-5 shadow-xl" 
           data-team="GAAZA" 
           data-results='[["1","Aslam","Calligraphy","Senior Off","1-A","8"]]'>
        <div class="score-badge">‚Äî</div>
        <h2 class="text-4xl font-black mb-1"></h2>
        <p class="text-lg font-semibold tracking-wide">GAAZA</p>
        <span class="mt-3 inline-block bg-white/90 text-slate-900 text-sm font-semibold px-3 py-1 rounded-full">View results</span>
      </div>

      <!-- Team 2 -->
      <div class="place p-5 shadow-xl" 
           data-team="ANTHAKIYA" 
           data-results='[["1","Amal","Art","Junior Off","A","01"],
                          ["1","Amal","Art","senior Off","A","01"]]'>
        <div class="score-badge">‚Äî</div>
        <h2 class="text-4xl font-black mb-1"></h2>
        <p class="text-lg font-semibold tracking-wide">ANTHAKIYA</p>
        <span class="mt-3 inline-block bg-white/90 text-slate-900 text-sm font-semibold px-3 py-1 rounded-full">View results</span>
      </div>

      <!-- Team 3 -->
      <div class="place p-5 shadow-xl" 
           data-team="ALEXANTRIYA" 
           data-results='[["1","Manu","Music","Junior Stage","B+","02"]]'>
        <div class="score-badge">‚Äî</div>
        <h2 class="text-4xl font-black mb-1"></h2>
        <p class="text-lg font-semibold tracking-wide">ALEXANTRIYA</p>
        <span class="mt-3 inline-block bg-white/90 text-slate-900 text-sm font-semibold px-3 py-1 rounded-full">View results</span>
      </div>

      <!-- Team 4 -->
      <div class="place p-5 shadow-xl" 
           data-team="GAZNI" 
           data-results='[["1","Ravi","Quiz","Junior Off","B","03"]]'>
        <div class="score-badge">‚Äî</div>
        <h2 class="text-4xl font-black mb-1"></h2>
        <p class="text-lg font-semibold tracking-wide">GAZNI</p>
        <span class="mt-3 inline-block bg-white/90 text-slate-900 text-sm font-semibold px-3 py-1 rounded-full">View results</span>
      </div>
    </section>
  </main>
</div>

<!-- Modal for Team Results -->
<div id="modal" class="fixed inset-0 z-50 items-center justify-center bg-black/60">
  <div class="modal-content w-[95%] lg:w-3/4 max-h-[90vh] overflow-y-auto p-6 relative">
    <button id="close" class="absolute right-4 top-4 text-3xl text-slate-600 hover:text-slate-900">√ó</button>
    <h2 id="team-name" class="text-2xl font-bold text-slate-800"></h2>

    <!-- Top Performer -->
    <div id="top-performer" class="top-performer mt-4 mb-4 hidden">
      <div style="display:flex;gap:1rem;align-items:center">
        <div class="avatar-circle text-slate-900" id="top-initial">A</div>
        <div>
          <div id="top-name" class="font-bold text-slate-900 text-lg"></div>
          <div id="top-meta" class="text-sm text-slate-600 mt-0.5"></div>
        </div>
      </div>
      <div style="text-align:right">
        <div class="text-sm text-slate-500">Top Combined Score</div>
        <div id="top-score" class="text-2xl font-extrabold text-sky-700">0</div>
      </div>
    </div>

    <!-- Search -->
    <div class="mt-2 relative">
      <span class="absolute left-4 top-3 text-slate-400">üîé</span>
      <input id="search" class="w-full border border-slate-200 rounded-full py-3 pl-12 pr-4 shadow-sm" placeholder="Search student, program, category, grade, score..." />
    </div>

    <!-- Results Sections -->
    <div id="result-sections" class="mt-6"></div>
  </div>
</div>

<!-- Gallery -->
<section class=" py-5">
<div class="container">
  <h2 class="text-center text-white mb-4">Image & Video Gallery</h2>
  <div class="row g-3">
    <div class="col-md-4 col-sm-6"><img src="1.jpg" class="img-fluid gallery-item"></div>
    <div class="col-md-4 col-sm-6"><img src="2.jpg" class="img-fluid gallery-item"></div>
    <div class="col-md-4 col-sm-6"><img src="3.jpg" class="img-fluid gallery-item"></div>
    <div class="col-md-4 col-sm-6"><img src="4.jpg" class="img-fluid gallery-item"></div>
    <div class="col-md-4 col-sm-6"><img src="5.jpg" class="img-fluid gallery-item"></div>
    <div class="col-md-4 col-sm-6"><img src="6.jpg" class="img-fluid gallery-item"></div>
    <div class="col-md-6"><video src="video1.mp4" muted autoplay controls width="100%"></video></div>
    <div class="col-md-6"><video src="LOGO.mp4" muted autoplay controls width="100%"></video></div>
  </div>
</div>
</section>

<!-- Gallery Modal -->
<div class="modal fade" id="galleryModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content bg-dark">
      <div class="modal-body text-center p-0"></div>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
// =====================
// Utility functions
// =====================
function safeParse(str){ try{ return JSON.parse(str); }catch(e){ return []; } }
function escapeHtml(s){ return String(s).replace(/[&<>"'`]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','`':'&#96;'}[c])); }
function highlight(text, term){ if(!term) return escapeHtml(text); try{ const re=new RegExp(term.replace(/[-\/\\^$*+?.()|[\]{}]/g,'\\$&'),'gi'); return escapeHtml(text).replace(re, m=>`<span class="highlight">${m}</span>`); }catch(e){ return escapeHtml(text);} }

// =====================
// Elements
// =====================
const podium = document.getElementById('podium');
let cardEls = [...podium.querySelectorAll('.place')];
const modal = document.getElementById('modal');
const teamNameEl = document.getElementById('team-name');
const resultSections = document.getElementById('result-sections');
const searchInput = document.getElementById('search');
const topPerformerBox = document.getElementById('top-performer');
const topName = document.getElementById('top-name');
const topMeta = document.getElementById('top-meta');
const topScore = document.getElementById('top-score');
const topInitial = document.getElementById('top-initial');

// =====================
// Compute team totals & reorder cards
// =====================
cardEls.forEach(card=>{
  const data = safeParse(card.dataset.results || "[]");
  const total = data.reduce((s,row)=> s + (parseInt(row[5],10)||0), 0);
  card.dataset.total = total;
});
cardEls.sort((a,b)=>parseInt(b.dataset.total,10)-parseInt(a.dataset.total,10));
cardEls.forEach((card, idx)=>{
  const rank = idx+1;
  const h2 = card.querySelector('h2');
  const badge = card.querySelector('.score-badge');
  h2.textContent = rank;  // now always 1,2,3,4
  badge.textContent = `Total: ${card.dataset.total}`;
  card.classList.remove('gold','silver','red','gray');
  if(rank===1) card.classList.add('gold');
  else if(rank===2) card.classList.add('silver');
  else if(rank===3) card.classList.add('red');
  else card.classList.add('gray');
  podium.appendChild(card);
});

// =====================
// Modal Logic
// =====================
cardEls.forEach(card=>{
  card.addEventListener('click', ()=>{
    const team = card.dataset.team || 'Team';
    teamNameEl.textContent = `${team} ‚Äî Total: ${card.dataset.total}`;
    const rows = safeParse(card.dataset.results || "[]");
    renderModal(rows);
    modal.classList.add('show');
    searchInput.value = '';
    searchInput.focus();
    searchInput.oninput = ()=> renderModal(rows, searchInput.value.trim().toLowerCase());
    document.addEventListener('keydown', escClose);
  });
});
function escClose(e){ if(e.key === 'Escape') closeModal(); }
document.getElementById('close').onclick = closeModal;
modal.addEventListener('click', e => { if(e.target === modal) closeModal(); });
function closeModal(){ modal.classList.remove('show'); topPerformerBox.classList.add('hidden'); document.removeEventListener('keydown', escClose); }

// =====================
// Render Modal Contents
// =====================
function renderModal(data, term=''){
  const studentTotals = {};
  data.forEach(row=>{
    if(!Array.isArray(row)) return;
    const [chessNo, student, prog, cat, grade, scoreRaw] = row.map(v => v==null? '' : String(v));
    const score = parseInt(scoreRaw,10) || 0;
    const key = student.trim().toLowerCase();
    if(!studentTotals[key]) studentTotals[key] = { name: student.trim(), total: 0, chess: [], progs: [] };
    studentTotals[key].total += score;
    if(chessNo) studentTotals[key].chess.push(chessNo);
    if(prog) studentTotals[key].progs.push(prog);
  });

  let top = null;
  const studentsArray = Object.values(studentTotals);
  if(studentsArray.length){
    top = studentsArray.reduce((a,b)=> (b.total > a.total ? b : a), studentsArray[0]);
  }

  if(top){
    topPerformerBox.classList.remove('hidden');
    topName.textContent = top.name;
    topMeta.textContent = `Programs: ${[...new Set(top.progs)].join(', ')} ‚Ä¢ IDs: ${[...new Set(top.chess)].join(', ')}`;
    topScore.textContent = top.total;
    topInitial.textContent = (top.name||'?').slice(0,1).toUpperCase();
  } else {
    topPerformerBox.classList.add('hidden');
  }

  const senior = [], junior = [];
  let totalFiltered = 0;
  data.forEach(row=>{
    if(!Array.isArray(row)) return;
    const [chessNo, student, prog, cat, grade, scoreRaw] = row.map(v => v==null? '' : String(v));
    const score = parseInt(scoreRaw,10) || 0;
    const valuesForFilter = [chessNo, student, prog, cat, grade, String(score)].map(s=>s.toLowerCase());
    const meets = !term || valuesForFilter.some(v => v.includes(term));
    if(!meets) return;
    totalFiltered += score;
    const rowHtml = `<tr>
      <td class="px-4 py-2 text-sm">${highlight(chessNo,term)}</td>
      <td class="px-4 py-2 text-sm">${highlight(student,term)}</td>
      <td class="px-4 py-2 text-sm">${highlight(prog,term)}</td>
      <td class="px-4 py-2 text-sm">${highlight(cat,term)}</td>
      <td class="px-4 py-2 text-sm">${highlight(grade,term)}</td>
      <td class="px-4 py-2 text-sm font-semibold">${highlight(String(score),term)}</td>
    </tr>`;
    if((cat||'').toLowerCase().includes('junior')) junior.push({html:rowHtml, score});
    else senior.push({html:rowHtml, score});
  });

  senior.sort((a,b)=>b.score - a.score);
  junior.sort((a,b)=>b.score - a.score);

  function tableMarkup(title, rowsArr){
    if(!rowsArr.length) return '';
    const subtotal = rowsArr.reduce((s,r)=>s + r.score, 0);
    return `
      <div class="mt-6">
        <div class="text-lg font-bold text-slate-700 mb-2">${escapeHtml(title)}</div>
        <div class="overflow-x-auto rounded-lg border border-slate-100 shadow-sm">
          <table class="min-w-full">
            <thead class="bg-slate-50">
              <tr>
                <th class="px-4 py-3 text-left text-xs text-slate-500 uppercase">Chess No</th>
                <th class="px-4 py-3 text-left text-xs text-slate-500 uppercase">Student</th>
                <th class="px-4 py-3 text-left text-xs text-slate-500 uppercase">Program</th>
                <th class="px-4 py-3 text-left text-xs text-slate-500 uppercase">Category</th>
                <th class="px-4 py-3 text-left text-xs text-slate-500 uppercase">Grade</th>
                <th class="px-4 py-3 text-left text-xs text-slate-500 uppercase">Score</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y">${rowsArr.map(r=>r.html).join('')}</tbody>
            <tfoot class="bg-slate-50">
              <tr>
                <td colspan="5" class="px-4 py-3 text-left font-semibold text-slate-700">Subtotal</td>
                <td class="px-4 py-3 text-left font-extrabold text-sky-600">${subtotal}</td>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
    `;
  }

  resultSections.innerHTML = `
    ${tableMarkup('Senior Events', senior)}
    ${tableMarkup('Junior Events', junior)}
    <div class="mt-6 p-4 rounded-xl bg-sky-50 text-center border border-sky-100">
      <div class="text-sm text-slate-600">Total Points Filtered</div>
      <div class="text-2xl font-extrabold text-sky-700">${totalFiltered}</div>
    </div>
  `;
}
</script>
</body>
</html>
